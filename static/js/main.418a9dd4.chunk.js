/*! For license information please see main.418a9dd4.chunk.js.LICENSE.txt */
(this["webpackJsonpcellular-automaton"]=this["webpackJsonpcellular-automaton"]||[]).push([[0],{109:function(e,t,n){e.exports=function(){return new Worker(n.p+"360c322880eafe2b008f.worker.js")}},117:function(e,t,n){e.exports=n(296)},124:function(e,t,n){},125:function(e,t,n){},126:function(e,t,n){},127:function(e,t,n){},295:function(e,t,n){},296:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(45),o=n.n(i),s=n(1),c=n(2),u=n(11),l=n(10),h=n(22);var f=n(7);function d(e){var t=Object(f.a)({fullscreen:!1,focused:!0},e);return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"gui.fullscreen":return Object(f.a)(Object(f.a)({},e),{},{fullscreen:n.value});case"gui.focused":return Object(f.a)(Object(f.a)({},e),{},{focused:n.value})}return e}}var m=n(4),v=n(108),_=n(5),p=function(){return{type:"step"}},b=function(){return{type:"randomise"}},g=function(){return{type:"clear"}},y=function(){return{type:"toggle"}},w=function(e){return{type:"gui.fullscreen",value:e}};function E(){var e=Object(m.c)((function(e){return e.app.sim.is_running})),t=Object(m.b)(),n=e?"Pause":"Run",r=e?"danger":"success";return a.a.createElement("div",{className:"btn-group"},a.a.createElement("button",{className:"btn btn-secondary",onClick:function(){return t(p())}},"Step"),a.a.createElement("button",{className:"btn btn-primary",onClick:function(){return t(b())}},"Randomise"),a.a.createElement("button",{className:"btn btn-warning",onClick:function(){return t(g())}},"Clear"),a.a.createElement("button",{className:"btn btn-"+r,onClick:function(){return t(y())}},n))}var x=n(13),O=n(3),j=function(){function e(t){var n=this;Object(s.a)(this,e),this.size=t,this.fov=50,this.aspect_ratio=1,this.view_position=O.c.fromValues(0,0,0),this.look_position=O.c.create(),this.target=O.c.fromValues(0,0,0),this.model_translation=O.c.create(),this.model=O.a.create(),this.view=O.a.create(),this.projection=O.a.create(),this.on_size_change(this.size.value),this.size.listen((function(e){return n.on_size_change(e.value)})),this.update()}return Object(c.a)(e,[{key:"on_size_change",value:function(e){this.model_translation=O.c.create(),O.c.scale(this.model_translation,e,-.5);var t=Math.max.apply(Math,Object(x.a)(e)),n=function(e){for(var t=0,n=e[0],r=1;r<e.length;r++){var a=e[r];a<n&&(n=a,t=r)}return t}(Object(x.a)(e));this.view_position=O.c.create(),this.view_position[n]=1.5*t,1===n&&(this.view_position[2]=1)}},{key:"update",value:function(){O.a.identity(this.model),O.a.translate(this.model,this.model,this.model_translation),O.a.scale(this.model,this.model,[1,1,1]),O.a.lookAt(this.view,this.view_position,this.target,[0,1,0]),O.a.perspective(this.projection,this.fov*Math.PI/180,this.aspect_ratio,.01,1e4)}},{key:"rotate",value:function(e,t){var n=O.a.create();O.a.rotateY(n,n,e);var r=O.c.create();O.c.sub(r,this.look_position,this.view_position),r[1]=this.look_position[1],O.c.rotateY(r,r,this.look_position,Math.PI/2),O.a.rotate(n,n,-t,r),O.c.transformMat4(this.view_position,this.view_position,n)}},{key:"zoom",value:function(e){var t=O.c.create();O.c.sub(t,this.view_position,this.look_position),O.c.scale(t,t,1+e),O.c.add(this.view_position,this.look_position,t)}}]),e}();var k=n(9),S=n(109),N=n.n(S),T=function(){function e(t,n){var r=this;Object(s.a)(this,e),this.size=t,this.stats=n,this.worker=N()(),this.promise_id=0,this.is_running=!1,this.set_size(this.size.value),this.size.listen((function(e){r.set_size(e.value)})),this.worker.addEventListener("message",(function(e){var t=e.data;if(t.error)console.error(t);else switch(t.action){case"stats":r.stats.recieve(t.data);break;case"grid":r.notify(t.grid,t.local)}})),this.worker.addEventListener("error",(function(e){console.error(e.message,e)})),this.listeners=new Set}return Object(c.a)(e,[{key:"notify",value:function(e,t){var n,r=Object(k.a)(this.listeners);try{for(r.s();!(n=r.n()).done;){(0,n.value)(e,t)}}catch(a){r.e(a)}finally{r.f()}this.set_grid(e)}},{key:"listen_available_frame",value:function(e){return this.listeners.add(e)}},{key:"unlisten_available_frame",value:function(e){return this.listeners.delete(e)}},{key:"set_size",value:function(e){this.use_worker("set_size",e)}},{key:"set_rule",value:function(e){this.use_worker("set_rule",e)}},{key:"set_randomiser",value:function(e){this.use_worker("set_randomiser",e)}},{key:"clear",value:function(){this.use_worker("clear")}},{key:"randomise",value:function(){this.use_worker("randomise")}},{key:"step",value:function(){this.use_worker("step")}},{key:"start",value:function(){this.use_worker("start"),this.is_running=!0}},{key:"stop",value:function(){this.use_worker("stop"),this.is_running=!1}},{key:"toggle",value:function(){this.is_running?this.stop():this.start()}},{key:"set_grid",value:function(e){this.use_worker("set_grid",e,e.transferables)}},{key:"request_frame",value:function(){this.use_worker("request_frame")}},{key:"use_worker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this.promise_id;this.promise_id+=1,this.worker.postMessage({action:e,id:r,data:t},n)}}]),e}(),z=function(){function e(t,n,r){Object(s.a)(this,e),this.gl=t,this.data=n,this.shape=r,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_3D,this.texture),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage3D(t.TEXTURE_3D,0,t.RG8,r[0],r[1],r[2],0,t.RG,t.UNSIGNED_BYTE,this.data)}return Object(c.a)(e,[{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_3D,this.texture)}}]),e}(),C=function(){function e(t,n,r){Object(s.a)(this,e),this.gl=t,this.data=n,this.shape=r,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA8,r[0],r[1],0,t.RGBA,t.UNSIGNED_BYTE,this.data)}return Object(c.a)(e,[{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)}}]),e}(),R=n(70),P=n.n(R);function A(){A=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(N){c=function(e,t,n){return e[t]=n}}function u(e,t,n,a){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),s=new j(a||[]);return r(o,"_invoke",{value:w(e,n,s)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(N){return{type:"throw",arg:N}}}e.wrap=u;var h={};function f(){}function d(){}function m(){}var v={};c(v,i,(function(){return this}));var _=Object.getPrototypeOf,p=_&&_(_(k([])));p&&p!==t&&n.call(p,i)&&(v=p);var b=m.prototype=f.prototype=Object.create(v);function g(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var a;r(this,"_invoke",{value:function(r,i){function o(){return new t((function(a,o){!function r(a,i,o,s){var c=l(e[a],e,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(h).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,s)}))}s(c.arg)}(r,i,a,o)}))}return a=a?a.then(o,o):o()}})}function w(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return S()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=E(o,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function E(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=l(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=m,r(b,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:d,configurable:!0}),d.displayName=c(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},g(y.prototype),c(y.prototype,o,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new y(u(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(b),c(b,s,"Generator"),c(b,i,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=k,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;O(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}var F=A().mark(D),M=function(){function e(t,n,r,a,i){var o=this;Object(s.a)(this,e),this.gl=t,this.size=n,this.set_size(this.size.value),this.size.listen((function(e){return o.set_size(e.value)})),this.sim=r,this.shader_manager=a,this.stats=i,this.max_neighbours=26,this.data_updated=!1,this.sim.listen_available_frame((function(e,t,n){o.update_texture_buffer(e,t,n)}))}return Object(c.a)(e,[{key:"set_size",value:function(e){var t=Object(_.a)(e,3),n=t[0],r=t[1],a=t[2];this.total_cells=n*r*a,this.create_textures(e)}},{key:"create_textures",value:function(e){var t=this.gl;this.state_colour_texture=function(e){for(var t=new Uint8Array(160),n=0;n<39;n++){var r=4*(n+1),a=200*(1-n/40),i=P.a.hsv_to_rgb(a,100,100),o=i.r,s=i.g,c=i.b;t[r+0]=o,t[r+1]=s,t[r+2]=c,t[r+3]=255}for(var u=0;u<4;u++)t[u]=0;return new C(e,t,[40,1])}(t),this.radius_colour_texture=function(e){for(var t=new Uint8Array(1440),n=0;n<360;n++){var r=4*n,a=360*(1-n/360),i=P.a.hsv_to_rgb(a,100,100),o=i.r,s=i.g,c=i.b;t[r+0]=o,t[r+1]=s,t[r+2]=c,t[r+3]=255}return new C(e,t,[360,1])}(t),this.cell_data_width=2,this.cell_data=new Uint8Array(this.total_cells*this.cell_data_width),this.cell_data_texture=new z(t,this.cell_data,e)}},{key:"update_texture_buffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?e.render_updates:D(0,e.count);t&&(e.render_updates=new Set);var r,a=e.cells,i=e.neighbours,o=0,s=performance.now(),c=this.cell_data_width,u=this.cell_data,l=Object(k.a)(n);try{for(l.s();!(r=l.n()).done;){var h=r.value,f=h*c,d=a[h],m=i[h];u[f+0]=d,u[f+1]=Math.floor(Math.min(m,this.max_neighbours)/this.max_neighbours*255),o+=1}}catch(_){l.e(_)}finally{l.f()}var v=performance.now();this.stats.recieve("texture_data_update",v-s),this.data_updated=this.data_updated||o>0}},{key:"load_texture_data",value:function(){var e=this.gl;if(this.data_updated){var t=performance.now(),n=Object(_.a)(this.size.value,3),r=n[0],a=n[1],i=n[2];e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,r,a,i,e.RG,e.UNSIGNED_BYTE,this.cell_data,0);var o=performance.now();this.stats.recieve("texture_data_upload",o-t),this.data_updated=!1}}},{key:"on_render",value:function(){this.shader_manager.bind(),this.cell_data_texture.bind(0),this.sim.request_frame(),this.load_texture_data(),this.state_colour_texture.bind(1),this.radius_colour_texture.bind(2);var e=performance.now();this.shader_manager.on_render();var t=performance.now();this.stats.recieve("draw_time",t-e)}}]),e}();function D(e,t){var n;return A().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e;case 1:if(!(n<t)){r.next=7;break}return r.next=4,n;case 4:n++,r.next=1;break;case 7:case"end":return r.stop()}}),F)}var L=function(){function e(t,n,r){Object(s.a)(this,e),this.gl=t,this.create_shader_program(n,r),this.uniforms=[],this.locations=[]}return Object(c.a)(e,[{key:"create_shader_program",value:function(e,t){var n=function(e,t,n){var r=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(r)),console.error(I(t)),new Error("Unable to compile vertex shader");var a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(a,n),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(a)),console.error(I(n)),new Error("Unable to compile fragment shader");var i=e.createProgram();if(e.attachShader(i,r),e.attachShader(i,a),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw console.error(e.getProgramInfoLog(i)),new Error("Unable to construct shader program");return[r,a,i]}(this.gl,e,t),r=Object(_.a)(n,3);this.vertex_shader=r[0],this.fragment_shader=r[1],this.program=r[2]}},{key:"add_uniform",value:function(e,t){var n=this.gl.getUniformLocation(this.program,e);this.uniforms.push(t),this.locations.push(n)}},{key:"bind",value:function(){this.gl.useProgram(this.program);for(var e=0;e<this.uniforms.length;e++){var t=this.uniforms[e],n=this.locations[e];null!==n&&t.apply(n)}}}]),e}();function I(e){return e.split("\n").map((function(e,t){return"".concat(t+1,"\t| ").concat(e)})).join("\n")}var U=function(){function e(t,n,r){Object(s.a)(this,e),this.gl=t,this.data=n,this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,n,r)}return Object(c.a)(e,[{key:"bind",value:function(){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vbo)}}]),e}(),G=function(){function e(t){Object(s.a)(this,e),this.gl=t,this.vao=t.createVertexArray(),this.integer_types=new Set([t.INT,t.UNSIGNED_INT])}return Object(c.a)(e,[{key:"add_vertex_buffer",value:function(e,t){var n=this.gl;this.bind(),e.bind();var r,a=0,i=Object(k.a)(t.attributes);try{for(i.s();!(r=i.n()).done;){var o=r.value;n.enableVertexAttribArray(o.index),this.integer_types.has(o.type)?n.vertexAttribIPointer(o.index,o.count,o.type,o.is_normalised,t.stride,a):n.vertexAttribPointer(o.index,o.count,o.type,o.is_normalised,t.stride,a),a+=o.count*o.size}}catch(s){i.e(s)}finally{i.f()}}},{key:"bind",value:function(){this.gl.bindVertexArray(this.vao)}}]),e}(),V=function(){function e(t){Object(s.a)(this,e),this.gl=t,this.stride=0,this.attributes=[]}return Object(c.a)(e,[{key:"push_attribute",value:function(e,t,n,r){var a=this.sizeof(n),i=new B(e,t,n,r,a);this.attributes.push(i),this.stride+=t*a}},{key:"slice",value:function(t,n){var r=new e;return r.stride=this.stride,r.attributes=this.attributes.slice(t,n),r}},{key:"sizeof",value:function(e){var t=this.gl;switch(e){case t.FLOAT:case t.UNSIGNED_INT:case t.INT:return 4;default:throw new Error("Unknown element type: ".concat(e))}}}]),e}(),B=Object(c.a)((function e(t,n,r,a,i){Object(s.a)(this,e),this.index=t,this.count=n,this.type=r,this.is_normalised=a,this.size=i})),X=function(){function e(t,n){Object(s.a)(this,e),this.gl=t,this.buffer=t.createBuffer(),this.count=n.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}return Object(c.a)(e,[{key:"bind",value:function(){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer)}}]),e}(),q=function(){function e(t,n){Object(s.a)(this,e),this.gl=t,this.data=n}return Object(c.a)(e,[{key:"apply",value:function(e){this.gl.uniformMatrix4fv(e,!1,this.data)}}]),e}(),Y=function(){function e(t,n){Object(s.a)(this,e),this.gl=t,this.data=n}return Object(c.a)(e,[{key:"apply",value:function(e){this.gl.uniform3f(e,this.data[0],this.data[1],this.data[2])}}]),e}(),W=function(){function e(t){Object(s.a)(this,e),this.callback=t}return Object(c.a)(e,[{key:"apply",value:function(e){this.callback(e)}}]),e}(),H="\nprecision mediump float;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform vec3 uOffset;\n\nvoid main() {\n    mat4 MVP = uProjection * uView * uModel;\n    gl_Position = MVP * vec4(position + uOffset, 1);\n}",K="\nprecision mediump float;\n\nuniform vec4 uColour;\n\nvoid main() {\n    gl_FragColor = uColour;\n}";var J={vertex_data:function(e,t,n,r,a,i){return new Float32Array([e,i,n,0,0,1,t,i,n,0,0,1,e,a,n,0,0,1,t,a,n,0,0,1,e,a,n,0,1,0,e,a,r,0,1,0,t,a,r,0,1,0,t,a,n,0,1,0,t,a,n,1,0,0,t,i,n,1,0,0,t,i,r,1,0,0,t,a,r,1,0,0,e,a,n,-1,0,0,e,a,r,-1,0,0,e,i,n,-1,0,0,e,i,r,-1,0,0,e,i,n,0,-1,0,e,i,r,0,-1,0,t,i,r,0,-1,0,t,i,n,0,-1,0,e,a,r,0,0,-1,t,a,r,0,0,-1,e,i,r,0,0,-1,t,i,r,0,0,-1])},index_data:new Uint32Array([0,3,2,0,1,3,4,6,5,4,7,6,8,9,11,9,10,11,13,14,12,13,15,14,16,18,19,16,17,18,20,21,22,21,23,22])};var $={vertex_data:function(e,t,n,r,a,i){return new Float32Array([e,i,n,t,i,n,e,a,n,t,a,n,e,i,r,t,i,r,e,a,r,t,a,r])},index_data:new Uint32Array([0,1,2,1,3,2,2,3,6,3,7,6,1,5,3,5,7,3,0,2,6,0,6,4,4,1,0,1,4,5,5,6,7,5,4,6])},Q=function(){function e(t,n){Object(s.a)(this,e);var r=this.generate(t,n),a=Object(_.a)(r,2),i=a[0],o=a[1];this.size=t,this.thickness=n,this.vertex_data=new Float32Array(i),this.index_data=new Uint32Array(o)}return Object(c.a)(e,[{key:"generate",value:function(e,t){var n=[],r=[],a=0;function i(e){var t=Object(_.a)(e,2),i=t[0],o=t[1];n.push.apply(n,Object(x.a)(i));var s=o.map((function(e){return e+a}));r.push.apply(r,Object(x.a)(s)),a+=24}for(var o=O.c.fromValues(t,t,t),s=0,c=[0,e[0]];s<c.length;s++)for(var u=c[s],l=0,h=[0,e[1]];l<h.length;l++)for(var f=h[l],d=0,m=[0,e[2]];d<m.length;d++){var v=m[d];i(this.create_cube([u,f,v],o))}o=O.c.fromValues(e[0]-t,t,t);for(var p=0,b=[0,e[1]];p<b.length;p++)for(var g=b[p],y=0,w=[0,e[2]];y<w.length;y++){var E=w[y],j=e[0]/2;i(this.create_cube([j,g,E],o))}o=O.c.fromValues(t,e[1]-t,t);for(var k=0,S=[0,e[0]];k<S.length;k++)for(var N=S[k],T=0,z=[0,e[2]];T<z.length;T++){var C=z[T],R=e[1]/2;i(this.create_cube([N,R,C],o))}o=O.c.fromValues(t,t,e[2]-t);for(var P=0,A=[0,e[0]];P<A.length;P++)for(var F=A[P],M=0,D=[0,e[1]];M<D.length;M++){var L=D[M],I=e[2]/2;i(this.create_cube([F,L,I],o))}return[n,r]}},{key:"create_cube",value:function(e,t){var n=e[0]-t[0]/2,r=e[0]+t[0]/2,a=e[1]+t[1]/2,i=e[1]-t[1]/2,o=e[2]-t[2]/2,s=e[2]+t[2]/2;return[J.vertex_data(n,r,o,s,a,i),J.index_data]}}]),e}(),Z=n(19),ee=n(34),te=n(12),ne=function(){function e(t,n,r){Object(s.a)(this,e),this.type=t,this.help=r,this._value=n,this.listeners=new Set}return Object(c.a)(e,[{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.notify()}},{key:"listen",value:function(e){this.listeners.add(e)}},{key:"unlisten",value:function(e){this.listeners.delete(e)}},{key:"notify",value:function(){var e,t=Object(k.a)(this.listeners);try{for(t.s();!(e=t.n()).done;){(0,e.value)(this)}}catch(n){t.e(n)}finally{t.f()}}}]),e}(),re=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,r){return Object(s.a)(this,n),t.call(this,"toggle",e,r)}return Object(c.a)(n,[{key:"value",get:function(){return Object(Z.a)(Object(te.a)(n.prototype),"value",this)},set:function(e){Object(ee.a)(Object(te.a)(n.prototype),"value",e,this,!0)}}]),n}(ne),ae=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,r){return Object(s.a)(this,n),t.call(this,"color",e,r)}return Object(c.a)(n,[{key:"value",get:function(){return Object(Z.a)(Object(te.a)(n.prototype),"value",this)},set:function(e){Object(ee.a)(Object(te.a)(n.prototype),"value",O.c.fromValues(e[0],e[1],e[2]),this,!0)}}]),n}(ne),ie=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this,"slider",a,i)).min=e,o.max=r,o}return Object(c.a)(n,[{key:"value",get:function(){return Object(Z.a)(Object(te.a)(n.prototype),"value",this)},set:function(e){e=this.clamp(e),Object(ee.a)(Object(te.a)(n.prototype),"value",e,this,!0)}},{key:"clamp",value:function(e){return e<this.min&&(e=this.min),e>this.max&&(e=this.max),e}}]),n}(ne),oe=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return Object(s.a)(this,n),(r=t.call(this,"dropdown",a,i)).options=e,r}return Object(c.a)(n,[{key:"value",get:function(){return Object(Z.a)(Object(te.a)(n.prototype),"value",this)},set:function(e){e=Math.min(e,this.options.length-1),Object(ee.a)(Object(te.a)(n.prototype),"value",e,this,!0)}},{key:"current_option",get:function(){return this.options[this.value]}}]),n}(ne),se=function(){function e(t,n,r){var a=this;Object(s.a)(this,e),this.gl=t,this.camera=r,this.colour=new ae([0,0,0],"Border Colour"),this.shader=new L(t,H,K),this.bind_uniforms(),this.size=n,this.set_size(this.size.value),this.size.listen((function(e){return a.set_size(e.value)}))}return Object(c.a)(e,[{key:"set_size",value:function(e){var t=this.gl,n=O.c.create();O.c.add(n,e,O.c.fromValues(1,1,1)),this.offset_vec=O.c.fromValues(-.5,-.5,-.5),this.border=new Q(n,.2),this.vbo=new U(t,this.border.vertex_data,t.STATIC_DRAW),this.index_buffer=new X(t,this.border.index_data);var r=new V(t);r.push_attribute(0,3,t.FLOAT,!1),r.push_attribute(1,3,t.FLOAT,!1),this.vao=new G(t),this.vao.add_vertex_buffer(this.vbo,r),this.shader.add_uniform("uOffset",new Y(t,this.offset_vec))}},{key:"bind_uniforms",value:function(){var e=this,t=this.gl;this.shader.add_uniform("uModel",new q(t,this.camera.model)),this.shader.add_uniform("uView",new q(t,this.camera.view)),this.shader.add_uniform("uProjection",new q(t,this.camera.projection)),this.shader.add_uniform("uColour",new W((function(n){var r=e.colour.value;t.uniform4f(n,r[0]/255,r[1]/255,r[2]/255,1)})))}},{key:"on_render",value:function(){var e=this.gl;this.shader.bind(),this.vao.bind(),this.index_buffer.bind(),e.drawElements(e.TRIANGLES,this.index_buffer.count,e.UNSIGNED_INT,0)}}]),e}(),ce=function(){function e(t,n,r){Object(s.a)(this,e),this.gl=t,this.props=Object(f.a)({size:O.c.create()},n),this.params=r}return Object(c.a)(e,[{key:"update_props",value:function(e){this.props=Object(f.a)(Object(f.a)({},this.props),e)}},{key:"add_params",value:function(e){this.params=Object(f.a)(Object(f.a)({},this.params),e)}},{key:"update_params",value:function(e){for(var t in e){this.params[t].value=e[t]}this.params=Object(f.a)({},this.params)}},{key:"add_uniforms",value:function(e){var t=this,n=this.gl;e.add_uniform("uModel",new q(n,this.props.camera.model)),e.add_uniform("uView",new q(n,this.props.camera.view)),e.add_uniform("uProjection",new q(n,this.props.camera.projection)),e.add_uniform("uViewPosition",new W((function(e){return n.uniform3f.apply(n,[e].concat(Object(x.a)(t.props.camera.view_position)))}))),e.add_uniform("uGridSize",new W((function(e){var r=Object(_.a)(t.props.size.value,3),a=r[0],i=r[1],o=r[2];n.uniform3f(e,a,i,o)}))),e.add_uniform("uStateTexture",new W((function(e){return n.uniform1i(e,0)}))),e.add_uniform("uStateColourTexture",new W((function(e){return n.uniform1i(e,1)}))),e.add_uniform("uRadiusColourTexture",new W((function(e){return n.uniform1i(e,2)})))}},{key:"bind",value:function(){}},{key:"on_render",value:function(){}}]),e}(),ue=function(e){return"#version 300 es\n\nprecision highp sampler3D;\nprecision highp sampler2D;\nprecision highp float;\n\nin vec3 vPosition;\nin vec3 vTexturePosition;\n\nuniform vec3 uGridSize;\nuniform vec3 uViewPosition;\n\nuniform sampler3D uStateTexture;\nuniform sampler2D uStateColourTexture;\nuniform sampler2D uRadiusColourTexture;\n\nuniform float uOcclusion;\nuniform float uStepFactor;\n\nout vec4 vFragColour;\n\nvoid main() {\n    vec3 view_direction = uViewPosition - vPosition;\n    vec3 step_size = normalize(view_direction);\n    // vec3 resize = abs(step_size);\n    // step_size /= max(resize.x, max(resize.y, resize.z));\n    step_size = step_size / uGridSize * uStepFactor;\n\n    vec3 tex_coords = vTexturePosition;\n    while (true) {\n        vec4 cell = texture(uStateTexture, tex_coords);\n        float state = cell[0];\n        float neighbours = cell[1];\n        float lighting = 1.0-neighbours*uOcclusion;\n        vec4 state_colour = texture(uStateColourTexture, vec2(state, 0.0));\n        vec4 neighbour_colour = texture(uStateColourTexture, vec2(neighbours, 0.0));\n        ".concat(e,"\n        tex_coords -= step_size;\n        if (tex_coords.x < 0.0 || tex_coords.x > 1.0 || \n            tex_coords.y < 0.0 || tex_coords.y > 1.0 ||\n            tex_coords.z < 0.0 || tex_coords.z > 1.0) \n        {\n            break;\n        }\n    }\n    vFragColour = vec4(0, 0, 0, 0);\n}\n")},le={vert_src:"#version 300 es\n\nprecision highp sampler3D;\nprecision highp sampler2D;\nprecision highp float;\n\nin vec3 position;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nuniform vec3 uGridSize;\nuniform vec3 uViewPosition;\n\nout vec3 vPosition;\nout vec3 vTexturePosition;\n\nvoid main() {\n    mat4 MVP = uProjection * uView * uModel;\n    vec3 vertex_pos = position * uGridSize;\n    vec4 pos = MVP * vec4(vertex_pos, 1.0);\n    // camera centered around (0,0,0)\n    // box has size uGridSize\n    vec3 camera_box = abs(uViewPosition);\n    vec3 volume_box = abs(uGridSize)/2.0;\n\n    // determine where to start ray trace if camera is inside the volume\n    if (camera_box.x < volume_box.x && camera_box.y < volume_box.y && camera_box.z < volume_box.z) {\n        vTexturePosition = uViewPosition/(uGridSize/2.0);\n        vTexturePosition += vec3(1.0,1.0,1.0);\n        vTexturePosition /= 2.0;\n    } else {\n        vTexturePosition = position;\n    }\n\n    vPosition = (uModel * vec4(vertex_pos, 1.0)).xyz;\n    gl_Position = pos;\n}\n",frag_src:{state:ue("if (state_colour.a != 0.0) {\n    vFragColour = vec4(state_colour.xyz*lighting, state_colour.a);\n    return;\n}\n"),xyz:ue("if (state_colour.a != 0.0) {\n    vFragColour = vec4(tex_coords*lighting, state_colour.a);\n    return;\n}\n"),layer:ue("if (state_colour.a != 0.0) {\n    vec3 distance = tex_coords - vec3(0.5, 0.5, 0.5);\n    float radius = length(distance * uGridSize);\n    float dist = mod(radius/10.0, 1.0); \n    vec4 dist_colour = texture(uRadiusColourTexture, vec2(dist, 0.0));\n    vFragColour = vec4(dist_colour.xyz*lighting, state_colour.a);\n    return;\n}\n"),radius:ue("if (state_colour.a != 0.0) {\n    vec3 distance = tex_coords - vec3(0.5, 0.5, 0.5);\n    float radius = length(distance * uGridSize);\n    float dist = length(distance) * 2.0;\n    vec4 dist_colour = texture(uRadiusColourTexture, vec2(dist, 0.0));\n    vFragColour = vec4(dist_colour.xyz*lighting, state_colour.a);\n    return;\n}\n"),neighbour:ue("if (neighbour_colour.a != 0.0) {\n    vFragColour = vec4(neighbour_colour.xyz*lighting, neighbour_colour.a);\n    return;\n}\n"),neighbour_and_alive:ue("float alpha = state_colour.a * neighbour_colour.a;\nif (alpha != 0.0) {\n    vFragColour = vec4(neighbour_colour.xyz*lighting, alpha);\n    return;\n}\n")}},he=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,r,a){var i;Object(s.a)(this,n),i=t.call(this,e,r,a);var o=fe(e),c=Object(_.a)(o,3);return i.vao=c[0],i.ibo=c[1],i.index_data=c[2],i.add_params({occlusion:new ie(0,1,.65,"Amount that nearby cells darken the center cell"),step_factor:new ie(.1,2,1,"Decrease to increase quality of volume render")}),i.create_shader(),i.params.colouring.listen((function(){i.create_shader()})),i}return Object(c.a)(n,[{key:"create_shader",value:function(){var e=this.params.colouring.current_option,t=le.vert_src,n=le.frag_src[e];this.shader=new L(this.gl,t,n),this.add_uniforms(this.shader)}},{key:"add_uniforms",value:function(e){var t=this;Object(Z.a)(Object(te.a)(n.prototype),"add_uniforms",this).call(this,e);var r=this.gl;e.add_uniform("uOcclusion",new W((function(e){return r.uniform1f(e,t.params.occlusion.value)}))),e.add_uniform("uStepFactor",new W((function(e){return r.uniform1f(e,t.params.step_factor.value)})))}},{key:"bind",value:function(){this.shader.bind(),this.vao.bind(),this.ibo.bind()}},{key:"on_render",value:function(){var e=this.gl;e.enable(e.CULL_FACE);var t=this.props.size.value.map((function(e){return Math.abs(e/2)})),n=Object(_.a)(t,3),r=n[0],a=n[1],i=n[2],o=this.props.camera.view_position.map(Math.abs),s=Object(_.a)(o,3),c=s[0],u=s[1],l=s[2];c<r&&u<a&&l<i?e.cullFace(e.FRONT):e.cullFace(e.BACK),e.drawElements(e.TRIANGLES,this.ibo.count,e.UNSIGNED_INT,0)}}]),n}(ce),fe=function(e){var t=new V(e);t.push_attribute(0,3,e.FLOAT,!1);var n=$.vertex_data(0,1,1,0,1,0),r=$.index_data,a=new U(e,n,e.STATIC_DRAW),i=new X(e,r),o=new G(e);return o.add_vertex_buffer(a,t),[o,i,r]},de={basic:function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nin vec4 vColour;\nin vec3 vFragPos;\nin vec3 vNormal;\n\nout vec4 fragColour;\n\nstruct Light {\n    vec3 position;\n    vec3 colour;\n};\n\nuniform Light light;\n\nuniform vec3 uViewPosition;\nuniform float uSpecularPowerFactor;\nfloat uSpecularScattering = 0.1;\n\n// vec3 uSkyTop =  vec3( 0.1, 0.2, 0.8 ) * 0.5;\n// vec3 uSkyBottom = vec3( 0.5, 0.8, 1.0 ) * 1.5;\n// vec3 uSunColour = vec3(1.0, 1.2, 1.4);\n\nvec3 uSkyTop =  vec3( 0.8, 0.8, 0.8 ) * 0.5;\nvec3 uSkyBottom = vec3( 0.8, 0.8, 0.8 ) * 1.5;\n\nuniform vec3 uSunColour;\n// vec3 uSunColour = vec3(1.0, 1.0, 1.0);\n\n\nfloat uFloorHeight = 0.0;\nfloat uAmbientOcclusionStrength = 0.8;\nfloat uAmbientOcclusionRange = 100.0;\n\nuniform float uSkyStrength;\nuniform float uSunStrength;\n\nvec4 uFogColour = vec4(1,1,1,1);\nuniform float uFogNear;\nuniform float uFogFar;\nfloat uFogRange = 1000.0;\n\nvec3 get_sun_direction() {\n    return normalize(vec3(20.0, 40.3, -10.4));\n}\n\nvec3 get_sun_lighting(const vec3 normal) {\n    vec3 light_direction = -get_sun_direction();\n    float angle = max(dot(normal, -light_direction), 0.0);\n    return uSunColour * uSunStrength * angle;\n}\n\nvec3 get_sky_lighting(const vec3 normal) {\n    float sky_blend = normal.y * 0.5 + 0.5;\n    vec3 sky_light = mix(uSkyBottom, uSkyTop, sky_blend);\n    return sky_light * uSkyStrength;  \n}\n\nvec3 get_sky_colour(vec3 view_direction) {\n    vec3 sky_colour = mix(uSkyBottom, uSkyTop, max(view_direction.y, 0.0));\n    return sky_colour * uSkyStrength;\n}\n\nvec4 apply_ambient_occlusion(const vec4 colour, const vec3 position) {\n    float height = (position.y - uFloorHeight) / uAmbientOcclusionRange;\n    height = abs(height);\n    float occlusion = mix(1.0, 1.0-uAmbientOcclusionStrength, clamp(0.0, 1.0, height));\n    return vec4(colour.xyz * occlusion, colour.a);\n}\n\nvec4 apply_fog(const vec4 colour, float distance) {\n    float norm_distance = distance / uFogRange;\n    float fog_strength = clamp(norm_distance, uFogNear, uFogFar);\n    return mix(colour, uFogColour, fog_strength);\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 view_direction = normalize(uViewPosition - vFragPos);\n\n    vec3 sky_lighting = get_sky_lighting(normal);\n    vec3 sky_colour = get_sky_colour(view_direction);\n    vec3 sun_lighting = get_sun_lighting(normal);\n    vec3 total_lighting = sky_lighting + sun_lighting + sky_colour;\n\n    vec4 result = vec4(total_lighting, 1) * vColour; \n    // result = apply_ambient_occlusion(result, vFragPos);\n\n    float distance = length(uViewPosition-vFragPos);\n    result = apply_fog(result, distance);\n\n    fragColour = result;\n}"},basic_alternate:function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nin vec4 vColour;\nin vec3 vFragPos;\nin vec3 vNormal;\n\nout vec4 fragColour;\n\nstruct Light {\n    vec3 position;\n    vec3 colour;\n};\n\nuniform Light light;\n\nuniform float uAmbientStrength;\nuniform float uDiffuseStrength;\nuniform float uSpecularStrength;\n\nuniform vec3 uViewPosition;\nuniform float uSpecularPowerFactor;\nfloat uSpecularScattering = 0.1;\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n\n    vec3 ambient = uAmbientStrength * light.colour;\n\n    vec3 light_position = vec3(-uViewPosition.x, uViewPosition.y, -uViewPosition.z);\n    vec3 light_direction = normalize(light_position - vFragPos);\n\n    float diff = max(dot(normal, light_direction), 0.0);\n    vec3 diffuse = diff * uDiffuseStrength * light.colour;\n\n    vec3 view_direction = normalize(uViewPosition - vFragPos);\n    vec3 reflect_direction = reflect(-light_direction, normal);\n    float spec = dot(view_direction, reflect_direction);\n    spec = clamp(spec + uSpecularScattering, 0.0, 1.0);\n    spec = pow(spec, uSpecularPowerFactor);\n    vec3 specular = uSpecularStrength * spec * light.colour;\n    \n    vec3 total_lighting = (ambient + diffuse + specular) * vColour.xyz;\n    vec4 result = vec4(total_lighting, 1.0);\n\n    fragColour = result;\n}"},no_shading:function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nuniform float uBrightness;\n\nin vec4 vColour;\n".concat(e?"":"in vec3 vNormal;","\n").concat(e?"":"in vec3 vFragPos;","\n\nout vec4 fragColour;\n\nvoid main() {\n    fragColour = vec4(vColour.xyz * uBrightness, vColour.a);\n}")}},me="\n".concat("vec3 calculate_offset(int index) {\n    float remain = float(index);\n    float z = floor(remain/(uGridSize.x*uGridSize.y));\n    remain = remain - z*uGridSize.x*uGridSize.y;\n    float y = floor(remain/uGridSize.x);\n    float x = remain - y*uGridSize.x; \n    return vec3(x, y, z);\n}","\n").concat("\nvec3 scale_position(float scale, vec3 pos) {\n    float K = max(scale, float(1-uScalingEnabled));\n    vec3 delta = pos-uCenter;\n    return uCenter + (K*delta);\n}\n","\n").concat("mat3 Rx(float a) {\n    return mat3(\n        1., 0., 0.,\n        0., cos(a), sin(a),\n        0., -sin(a), cos(a)\n    );\n}\n\nmat3 Ry(float a) {\n    return mat3(\n        cos(a), 0., -sin(a),\n        0, 1., 0.,\n        sin(a), 0., cos(a)\n    );\n}\n\nvec3 calculate_point_cloud(const vec3 pos, const vec3 offset) {\n    vec3 point_position = offset+uCenter-(uGridSize/2.0);\n    vec3 view_direction = uViewPosition-point_position;\n    vec2 xz = vec2(view_direction.x, view_direction.z);\n    float r = length(xz);\n    float ay = atan(view_direction.x, view_direction.z);\n    float ax = -atan(view_direction.y, r);\n    mat3 R = Ry(ay) * Rx(ax);\n    return R*(pos-uCenter) + uCenter + offset; \n}","\n").concat("\nvec4 get_cell_data(vec3 offset) {\n    vec3 vol_tex_coords = offset / uGridSize;\n    vec4 cell = texture(uStateTexture, vol_tex_coords);\n    return cell;\n}\n","\n"),ve=function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp sampler3D;\nprecision highp sampler2D;\nprecision highp int;\n\nin vec3 position;\n".concat(e?"":"in vec3 normal;","\n\n// MVP\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform vec3 uViewPosition;\nuniform vec3 uGridSize;\n// params\nuniform int uScalingEnabled;\nuniform float uOcclusion;\n// texturing\nuniform sampler2D uStateColourTexture;\nuniform sampler2D uRadiusColourTexture;\nuniform sampler3D uStateTexture;\n\nvec3 uCenter = vec3(0.5, 0.5, 0.5);\n\nout vec4 vColour;\n").concat(e?"":"out vec3 vNormal;","\n").concat(e?"":"out vec3 vFragPos;","\n\n").concat(me,"\n")},_e=function(e){return"\n".concat(e?"vPosition = calculate_point_cloud(vPosition, offset);":"vPosition = vPosition + offset;","\n\n// pass through data\nvPosition *= vColour.a;\nmat4 MVP = uProjection * uView * uModel;\n").concat(e?"":"vNormal = normal;","\n").concat(e?"":"vFragPos = vec3(uModel * vec4(vPosition, 1.0));","\ngl_Position = MVP * vec4(vPosition, 1.0);\n")},pe={state:function(e){return"".concat(ve(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nfloat lighting = 1.0-(neighbours*uOcclusion);\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 vPosition = scale_position(state, position);\n    vColour = vec4(state_colour.xyz*lighting, state_colour.a);\n    ").concat(_e(e),"\n}")},xyz:function(e){return"".concat(ve(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nfloat lighting = 1.0-(neighbours*uOcclusion);\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 vPosition = scale_position(state, position);\n    vec3 xyz_colour = offset / uGridSize;\n    vColour = vec4(xyz_colour*lighting, state_colour.a);\n    ").concat(_e(e),"\n}\n")},layer:function(e){return"".concat(ve(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nfloat lighting = 1.0-(neighbours*uOcclusion);\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 vPosition = scale_position(state, position);\n    vec3 distance = offset - (uGridSize/2.0);\n    float dist = length(distance/10.0);\n    dist = mod(dist, 1.0);\n    vec4 dist_colour = texture(uRadiusColourTexture, vec2(dist, 0.0));\n    vColour = vec4(dist_colour.xyz*lighting, state_colour.a);\n    ").concat(_e(e),"\n}")},radius:function(e){return"".concat(ve(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nfloat lighting = 1.0-(neighbours*uOcclusion);\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 xyz_center = uGridSize/2.0;\n    vec3 distance = offset-xyz_center;\n    float radius = length(distance/xyz_center);\n    float total_repeats = 1.0;\n    radius = clamp(radius, 0.0, 1.0) * total_repeats;\n    vec4 radius_colour = texture(uRadiusColourTexture, vec2(radius, 0.0));\n\n    vec3 vPosition = scale_position(state, position);\n    vColour = vec4(radius_colour.xyz*lighting, state_colour.a);\n    ").concat(_e(e),"\n}")},neighbour:function(e){return"".concat(ve(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nfloat lighting = 1.0-(neighbours*uOcclusion);\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec4 neighbour_colour = texture(uStateColourTexture, vec2(neighbours, 0.0));\n\n    vec3 vPosition = scale_position(neighbours, position);\n    vColour = vec4(neighbour_colour.xyz*lighting, neighbour_colour.a);\n    ").concat(_e(e),"\n}")},neighbour_and_alive:function(e){return"".concat(ve(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nfloat lighting = 1.0-(neighbours*uOcclusion);\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec4 neighbour_colour = texture(uStateColourTexture, vec2(neighbours, 0.0));\n\n    vec3 vPosition = scale_position(neighbours, position);\n    vColour = vec4(neighbour_colour.xyz*lighting, state_colour.a*neighbour_colour.a);\n    ").concat(_e(e),"\n}")}},be=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this,e,r,a)).add_params({point_type:new oe(["quad","tri"],0,"Render quad or triangle for each point"),brightness:new ie(0,1,1,"Global brightness"),occlusion:new ie(0,1,.65,"Amount nearby cells darken the center cell"),scaling_enabled:new re(0,"Size of cell varies with its value")}),i.data={quad:ge(e),tri:ye(e)},i.create_shader(),i.params.colouring.listen((function(e){i.create_shader()})),i}return Object(c.a)(n,[{key:"create_shader",value:function(){var e=this.params.colouring.current_option,t=pe[e](!0),n=de.no_shading(!0);this.shader=new L(this.gl,t,n),this.add_uniforms(this.shader)}},{key:"add_uniforms",value:function(e){var t=this;Object(Z.a)(Object(te.a)(n.prototype),"add_uniforms",this).call(this,e);var r=this.gl;e.add_uniform("uBrightness",new W((function(e){return r.uniform1f(e,t.params.brightness.value)}))),e.add_uniform("uOcclusion",new W((function(e){return r.uniform1f(e,t.params.occlusion.value)}))),e.add_uniform("uScalingEnabled",new W((function(e){return r.uniform1i(e,t.params.scaling_enabled.value)})))}},{key:"current_data",get:function(){return this.data[this.params.point_type.current_option]}},{key:"bind",value:function(){this.shader.bind();var e=this.current_data;e.vao.bind(),e.ibo.bind()}},{key:"on_render",value:function(){var e=this.gl,t=this.current_data,n=Object(_.a)(this.props.size.value,3),r=n[0]*n[1]*n[2];e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.drawElementsInstanced(e.TRIANGLES,t.ibo.count,e.UNSIGNED_INT,t.index_data,r)}}]),n}(ce),ge=function(e){var t=new V(e);t.push_attribute(0,3,e.FLOAT,!1);var n=new Float32Array([0,1,.5,1,1,.5,0,0,.5,1,0,.5]),r=new Uint32Array([2,1,0,2,3,1]),a=new U(e,n,e.STATIC_DRAW),i=new X(e,r),o=new G(e);return o.add_vertex_buffer(a,t),{vao:o,ibo:i,index_data:r}},ye=function(e){var t=new V(e);t.push_attribute(0,3,e.FLOAT,!1);var n=new Float32Array([-.5,-.5,.5,1.5,-.5,.5,.5,-1.5,.5]),r=new Uint32Array([2,1,0]),a=new U(e,n,e.STATIC_DRAW),i=new X(e,r),o=new G(e);return o.add_vertex_buffer(a,t),{vao:o,ibo:i,index_data:r}},we=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,r,a){var i;Object(s.a)(this,n),(i=t.call(this,e,r,{})).shading_params={ambient_strength:new ie(0,1,.4,"Amount of global lighting"),diffuse_strength:new ie(0,1,.95,"Amount of light scattering"),specular_strength:new ie(0,1,.6,"Amount of light reflection"),specular_power_factor:new ie(0,128,4,"Strength of the light reflection"),scaling_enabled:new re(0,"Change size of cell depending on its value (state or total neighbours)"),fog_near:new ie(0,1,0,"Minimum distance of fog"),fog_far:new ie(0,1,0,"Maximum distance of fog"),sun_strength:new ie(0,1,.95,"Strength of the sun"),sky_strength:new ie(0,1,.25,"Strength of sky lighting"),brightness:new ie(0,1,1,"Amount of global lighting"),occlusion:new ie(0,1,0,"Amount nearby cells darken the center cell"),light_colour:new ae(O.c.fromValues(255,255,255),"Colour of sun")},i.global_params=Object(f.a)(Object(f.a)({},a),{},{shading:new oe(Object.keys(de),0,"Different methods of rendering")}),i.shading_keys={basic:["occlusion","sun_strength","sky_strength","fog_near","fog_far","light_colour","scaling_enabled"],basic_alternate:["occlusion","ambient_strength","diffuse_strength","specular_strength","specular_power_factor","light_colour","scaling_enabled"],no_shading:["occlusion","brightness","scaling_enabled"]},i.update_props({light_position:O.c.create()});var o=Ee(e),c=Object(_.a)(o,3);return i.vao=c[0],i.ibo=c[1],i.index_data=c[2],i.create_shader(),i.params.colouring.listen((function(){return i.create_shader()})),i.params.shading.listen((function(){return i.create_shader()})),i}return Object(c.a)(n,[{key:"create_shader",value:function(){this.load_params();var e=this.global_params.colouring.current_option,t=this.global_params.shading.current_option,n=pe[e](!1),r=de[t](!1);this.shader=new L(this.gl,n,r),this.add_uniforms(this.shader)}},{key:"load_params",value:function(){var e,t={},n=this.global_params.shading.current_option,r=this.shading_keys[n],a=Object(k.a)(r);try{for(a.s();!(e=a.n()).done;){var i=e.value;t[i]=this.shading_params[i]}}catch(o){a.e(o)}finally{a.f()}this.params=Object(f.a)(Object(f.a)({},this.global_params),t)}},{key:"add_uniforms",value:function(e){var t=this;Object(Z.a)(Object(te.a)(n.prototype),"add_uniforms",this).call(this,e);var r=this.gl;e.add_uniform("light.position",new Y(r,this.props.light_position)),e.add_uniform("light.colour",new W((function(e){var n=t.shading_params.light_colour.value;r.uniform3f(e,n[0]/255,n[1]/255,n[2]/255)}))),e.add_uniform("uSunColour",new W((function(e){var n=t.shading_params.light_colour.value;r.uniform3f(e,n[0]/255,n[1]/255,n[2]/255)}))),e.add_uniform("uAmbientStrength",new W((function(e){return r.uniform1f(e,t.params.ambient_strength.value)}))),e.add_uniform("uDiffuseStrength",new W((function(e){return r.uniform1f(e,t.params.diffuse_strength.value)}))),e.add_uniform("uSpecularStrength",new W((function(e){return r.uniform1f(e,t.params.specular_strength.value)}))),e.add_uniform("uSpecularPowerFactor",new W((function(e){return r.uniform1f(e,t.params.specular_power_factor.value)}))),e.add_uniform("uBrightness",new W((function(e){return r.uniform1f(e,t.params.brightness.value)}))),e.add_uniform("uOcclusion",new W((function(e){return r.uniform1f(e,t.params.occlusion.value)}))),e.add_uniform("uScalingEnabled",new W((function(e){return r.uniform1i(e,t.params.scaling_enabled.value)}))),e.add_uniform("uFogNear",new W((function(e){return r.uniform1f(e,t.params.fog_near.value)}))),e.add_uniform("uFogFar",new W((function(e){return r.uniform1f(e,t.params.fog_far.value)}))),e.add_uniform("uSunStrength",new W((function(e){return r.uniform1f(e,t.params.sun_strength.value)}))),e.add_uniform("uSkyStrength",new W((function(e){return r.uniform1f(e,t.params.sky_strength.value)})))}},{key:"bind",value:function(){this.shader.bind(),this.vao.bind(),this.ibo.bind()}},{key:"on_render",value:function(){var e=this.gl,t=Object(_.a)(this.props.size.value,3),n=t[0]*t[1]*t[2];e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.drawElementsInstanced(e.TRIANGLES,this.ibo.count,e.UNSIGNED_INT,this.index_data,n)}}]),n}(ce),Ee=function(e){var t=new V(e);t.push_attribute(0,3,e.FLOAT,!1),t.push_attribute(1,3,e.FLOAT,!1);var n=J.vertex_data(0,1,1,0,1,0),r=J.index_data,a=new U(e,n,e.STATIC_DRAW),i=new X(e,r),o=new G(e);return o.add_vertex_buffer(a,t),[o,i,r]},xe=function(){function e(t,n,r){Object(s.a)(this,e),this.gl=t,this.size=n,this.camera=r;var a={size:this.size,camera:this.camera};this.global_params={colouring:new oe(Object.keys(pe),0,"Method of colouring each cell")},this.renderers={volume:new he(t,a,this.global_params),point:new be(t,a,this.global_params),voxel:new we(t,a,this.global_params)};this.renderer_type=new oe(Object.keys(this.renderers),0,"Method of rendering the grid\nVolume: Fastest but low quality (Uses raycasting)\nPoint: Represents each cell as a floating quad\nVoxel: Slowest but highest quality (Like Minecraft)\n")}return Object(c.a)(e,[{key:"current_renderer",get:function(){var e=this.renderer_type.current_option;return this.renderers[e]}},{key:"select_renderer",value:function(e){this.renderer_type.value=e}},{key:"params",get:function(){return this.current_renderer.params}},{key:"update_params",value:function(e){this.current_renderer.update_params(e)}},{key:"bind",value:function(){this.current_renderer.bind()}},{key:"on_render",value:function(){this.current_renderer.on_render()}}]),e}(),Oe=function(){function e(t,n){Object(s.a)(this,e),this.type=t,this.params=n}return Object(c.a)(e,[{key:"to_json",value:function(){var e={};for(var t in this.params)e[t]=this.params[t].value;return{type:this.type,params:e}}}]),e}(),je=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return Object(s.a)(this,n),t.call(this,"Seed Crystal",{density:new ie(0,1,e,"Amount of region to fill"),radius:new ie(0,.5,r,"Radius of cube to fill (Relative to size of 3D grid)")})}return Object(c.a)(n)}(Oe),ke=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Object(s.a)(this,n),t.call(this,"Seed Crystal Absolute",{density:new ie(0,1,e,"Amount of region to fill"),radius:new ie(0,100,r,"Radius of cube to fill (Number of cells for radius)")})}return Object(c.a)(n)}(Oe),Se=function(){function e(t,n,r,a){Object(s.a)(this,e),this.remain=t,this.become=n,this.total_states=r,this.neighbour=a}return Object(c.a)(e,[{key:"to_json",value:function(){return this}}]),e}(),Ne=function(){function e(t,n){Object(s.a)(this,e),this.type=t,this.max=n}return Object(c.a)(e,[{key:"to_json",value:function(){return this}}]),e}(),Te={M:new Ne("M",26),VN:new Ne("VN",6)},ze=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,[{key:"generate",value:function(e){var t=(e=e.replace(" ","")).split("/");if(4!==t.length)throw new Error("Expected Range/Range/Number/(VN or M).\nEg: 0,1-4,5/0-26/5/VN");var n=Object(_.a)(t,4),r=n[0],a=n[1],i=n[2],o=n[3];if(void 0===Te[o])throw new Error("Invalid neighbourhood. Expected M or VN.");if((i=this.convert_to_number(i))<=1)throw new Error("Invalid total states. Expected 2 or more states");o=Te[o];var s=this.retrieve_rule(r),c=this.retrieve_rule(a);return new Se(s,c,i,o)}},{key:"retrieve_rule",value:function(e){var t=this,n=new Array(27);n.fill(!1,0,-1);var r,a=e.split(","),i=Object(k.a)(a);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(0===o.length)throw new Error("Invalid number, cannot be ''");if("-"===o[0])throw new Error("Range must have number in front: ".concat(o,"\nEg. 0-26"));if("-"===o[o.length-1])throw new Error("Range must have number at back: ".concat(o,"\nEg. 0-26"));var s=o.split("-").map((function(e){return t.convert_to_number(e)}));if(1===s.length){var c=s[0];this.assert_number(c),n[c]=!0}else{if(2!==s.length)throw new Error("Too many numbers in range: ".concat(e,". Must be 1 or 2"));var u=Object(_.a)(s,2),l=u[0],h=u[1];if(h<l)throw new Error("Invalid range: ".concat(l,"-").concat(h,". Must be ordered."));for(var f=l;f<=h;f++)this.assert_number(f),n[f]=!0}}}catch(d){i.e(d)}finally{i.f()}return n}},{key:"convert_to_number",value:function(e){if(isNaN(e))throw new Error("".concat(e," is not a valid number"));return Number(e)}},{key:"assert_number",value:function(e){if(e<0||e>26)throw new Error("Invalid number: ".concat(e,". Must be between 0 to 26"))}}]),e}(),Ce=Object(c.a)((function e(t,n,r){Object(s.a)(this,e),this.name=t,this.description=n;var a=(new ze).generate(n);this.rule=a,this.randomiser=r})),Re=function(){function e(){Object(s.a)(this,e),this.entries=[],this.listeners=new Set,this.add_entry(new Ce("Amoeba-1","9-26/5-7,12-13,15/16/M",new ke(.3,5))),this.add_entry(new Ce("445","4/4/5/M",new je(.05,.5))),this.add_entry(new Ce("Builder 2","6,9/4,6,8-9/10/M",new ke(.35,7))),this.add_entry(new Ce("Crystal Growth 1","0-6/1,3/2/VN",new ke(1,1))),this.add_entry(new Ce("Crystal Growth 2","1-3/1-3/5/VN",new ke(1,1))),this.add_entry(new Ce("Clouds 1","13-26/13-14,17-19/2/M",new je(.5,.5))),this.add_entry(new Ce("Slow Decay","8,11,13-26/13-26/5/M",new je(.45,1))),this.add_entry(new Ce("Spiky Growth 1","7-26/4,12-13,15/10/M",new ke(.32,7))),this.add_entry(new Ce("Ripple Cube","8-26/4,12-13,15/10/M",new ke(.35,14))),this.add_entry(new Ce("Amoeba-2","9-26/5-7,12-13,15/5/M",new ke(.3,5))),this.add_entry(new Ce("Builder 1","6,9/4,6,8-9/10/M",new ke(.35,7))),this.add_entry(new Ce("Pyroclastic","4-7/6-8/10/M",new ke(.2,5))),this.add_entry(new Ce("678 678","6-8/6-8/3/M",new je(.3))),this.select(0)}return Object(c.a)(e,[{key:"listen_select",value:function(e){this.listeners.add(e)}},{key:"notify",value:function(e){var t,n=Object(k.a)(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"selected_entry",get:function(){return this.entries[this.current_index]}},{key:"select",value:function(e){this.current_index=e;var t=this.selected_entry;this.notify(t)}},{key:"add_entry",value:function(e){this.entries.push(e)}}]),e}(),Pe=function(){function e(){var t=this;Object(s.a)(this,e),this.entries=[],this.listeners=new Set,this.db_cfg={name:"entries_db",store:"entries_os"};var n=window.indexedDB.open(this.db_cfg.name,1);n.onerror=function(e){return console.error("".concat(t.db_cfg.name," failed to open"))},n.onsuccess=function(e){t.db=n.result,t.on_db_load()},n.onupgradeneeded=function(e){var n=e.target.result.createObjectStore(t.db_cfg.store,{keyPath:"id",autoIncrement:!0});n.createIndex("name","name",{unique:!1}),n.createIndex("ca_string","ca_string",{unique:!1})},this.current_index=-1}return Object(c.a)(e,[{key:"listen_select",value:function(e){this.listeners.add(e)}},{key:"notify",value:function(e){var t,n=Object(k.a)(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"on_db_load",value:function(){var e=this,t=this.db_cfg,n=this.db.transaction(t.store).objectStore(t.store),r=[];n.openCursor().onsuccess=function(t){var n=t.target.result;if(n){var a=n.value,i=a.name,o=a.ca_string,s=a.id;try{var c=new Ae(i,o,s);e.add_entry(c)}catch(u){r.push(s)}n.continue()}else e.purge_corrupted_ids(r)}}},{key:"purge_corrupted_ids",value:function(e){e&&e.length>0&&(console.warn("Purging corrupted ids"),console.warn(e));var t,n=this.db_cfg,r=this.db.transaction([n.store],"readwrite").objectStore(n.store),a=Object(k.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;r.delete(i)}}catch(o){a.e(o)}finally{a.f()}}},{key:"edit",value:function(e,t,n){var r=this,a=this.entries[e];if(a){var i=new Ae(t,n,a.id),o=this.db,s=this.db_cfg;if(o){var c={id:a.id,name:t,ca_string:n},u=o.transaction([s.store],"readwrite");return u.objectStore(s.store).put(c),new Promise((function(t,n){u.oncomplete=function(n){r.entries[e]=i,r.entries=Object(x.a)(r.entries),r.current_index===e&&r.notify(i),t(!0)},u.onerror=function(){console.error("Failed to update entry: ".concat(a," to ").concat(i)),n("Failed to update entry: ".concat(a," to ").concat(i))}}))}console.error("".concat(s.store," failed to load"))}}},{key:"create",value:function(e,t){var n=this,r=new Ae(e,t),a=this.db,i=this.db_cfg;if(a){var o={name:e,ca_string:t},s=a.transaction([i.store],"readwrite").objectStore(i.store).add(o);return new Promise((function(a,i){s.onsuccess=function(e){var t=e.target.result;r.id=t,n.add_entry(r),a(!0)},s.onerror=function(){console.error("Failed to add entry: ".concat(e,", ").concat(t)),i("Failed to add entry: ".concat(e,", ").concat(t))}}))}console.error("".concat(i.store," failed to load"))}},{key:"delete",value:function(e){var t=this;if(!(e<0||e>=this.entries.length)){var n=this.current_index;n=this.current_index===e?this.current_index:this.current_index>e?this.current_index-1:this.current_index;var r=this.entries[e],a=this.db_cfg,i=this.db.transaction([a.store],"readwrite");return i.objectStore(a.store).delete(r.id),new Promise((function(r,a){i.oncomplete=function(){var a=t.entries;t.entries=[].concat(Object(x.a)(a.slice(0,e)),Object(x.a)(a.slice(e+1))),n=Math.max(n,0),n=Math.min(n,t.entries.length-1),0===t.entries.length&&(n=-1),t.select(n),r(!0)}}))}}},{key:"selected_entry",get:function(){return this.entries[this.current_index]}},{key:"select",value:function(e){if(this.current_index=e,this.current_index<0||this.current_index>=this.entries.length)this.notify(void 0);else{var t=this.selected_entry;this.notify(t)}}},{key:"add_entry",value:function(e){this.entries=[].concat(Object(x.a)(this.entries),[e])}}]),e}(),Ae=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this,e,r)).id=a,i}return Object(c.a)(n)}(Ce),Fe=function(){function e(){var t=this;Object(s.a)(this,e),this.listeners=new Set,this.browsers={Default:new Re,User:new Pe},this.current_browser_key="System",this.browsers.Default.listen_select((function(e){t.notify(e)})),this.browsers.User.listen_select((function(e){void 0===e?t.select("Default",0):t.notify(e)}))}return Object(c.a)(e,[{key:"listen_select",value:function(e){this.listeners.add(e)}},{key:"notify",value:function(e){var t,n=Object(k.a)(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"selected_entry",get:function(){return this.selected_browser.selected_entry}},{key:"selected_browser",get:function(){return this.browsers[this.current_browser_key]}},{key:"get_entries",value:function(e){return this.browsers[e].entries}},{key:"select",value:function(e,t){this.current_browser_key=e,this.selected_browser.select(t)}},{key:"delete",value:function(e,t){var n=this;return new Promise((function(r,a){"User"===e?n.browsers.User.delete(t).then((function(e){return r(e)}),(function(e){return a(e)})):a("Can only delete user defined rules")}))}},{key:"create",value:function(e,t){var n=this;return new Promise((function(r,a){try{n.browsers.User.create(e,t).then((function(e){return r(e)}),(function(e){return a(e)}))}catch(i){a(String(i.message))}}))}},{key:"edit",value:function(e,t,n,r){var a=this.browsers[e];return new Promise((function(e,i){try{a.edit(t,n,r).then((function(t){return e(t)}),(function(e){return i(e)}))}catch(o){i(String(o.message))}}))}}]),e}(),Me=function(){function e(t){Object(s.a)(this,e),this.store=t,this.data={completed_blocks:0,frame_time:0,total_blocks:0,total_steps:0,texture_data_update:0,texture_data_upload:0,draw_time:0},this.cooldown=!1}return Object(c.a)(e,[{key:"force_update",value:function(){var e=this;this.cooldown||this.store.dispatch((function(t){e.cooldown=!0,setTimeout((function(){t({type:"stats.update",value:e}),setTimeout((function(){return e.cooldown=!1}),30)}),0)}))}},{key:"recieve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0!==t?this.recieve_key(e,t):this.recieve_batch(e)}},{key:"recieve_key",value:function(e,t){this.data[e]=t,this.data=Object(f.a)({},this.data),this.force_update()}},{key:"recieve_batch",value:function(e){for(var t in e){var n=e[t];this.data[t]=n}this.data=Object(f.a)({},this.data),this.force_update()}}]),e}(),De=function(){function e(){Object(s.a)(this,e),this.entries=[],this.add_randomiser(new je),this.add_randomiser(new ke),this.current_index=0,this.listeners=new Set}return Object(c.a)(e,[{key:"listen_select",value:function(e){this.listeners.add(e)}},{key:"notify",value:function(e){var t,n=Object(k.a)(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"add_randomiser",value:function(e){this.entries.push(e)}},{key:"update_randomiser",value:function(e){for(var t=e.type,n=e.params,r=0;r<this.entries.length;r++){var a=this.entries[r];if(a.type===t){for(var i in n)a.params[i].value=n[i].value;a.params=Object(f.a)({},a.params),this.current_index=r;break}}this.notify(this.current_randomiser)}},{key:"update_current",value:function(e,t){this.current_randomiser.params[e].value=t,this.current_randomiser.params=Object(f.a)({},this.current_randomiser.params)}},{key:"select",value:function(e){this.current_index=e,this.notify(this.current_randomiser)}},{key:"current_randomiser",get:function(){return this.entries[this.current_index]}}]),e}(),Le=function(){function e(t){Object(s.a)(this,e),this._value=t,this.listeners=new Set}return Object(c.a)(e,[{key:"listen",value:function(e){return this.listeners.add(e)}},{key:"unlisten",value:function(e){return this.listeners.delete(e)}},{key:"notify",value:function(){var e,t=Object(k.a)(this.listeners);try{for(t.s();!(e=t.n()).done;){(0,e.value)(this)}}catch(n){t.e(n)}finally{t.f()}}},{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.notify()}}]),e}(),Ie=function(){function e(t,n){var r=this;Object(s.a)(this,e),this.gl=t,this.store=n,t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.show_border=new re(!0,"Show an outlining border"),this.show_render=new re(!0,"Show the grid of cells (Disable if you want to see result later)"),this.background_colour=new ae([255,255,255],"Background Colour");this.size=new Le(O.c.fromValues(100,100,100)),this.camera=new j(this.size),this.shader_manager=new xe(t,this.size,this.camera),this.randomiser_manager=new De,this.entry_browser=new Fe,this.stats=new Me(this.store),this.sim=new T(this.size,this.stats),this.sim_renderer=new M(t,this.size,this.sim,this.shader_manager,this.stats),this.border=new se(t,this.size,this.camera),this.randomiser_manager.listen_select((function(e){r.sim.set_randomiser(e.to_json())})),this.entry_browser.listen_select((function(e){var t=e.randomiser,n=e.rule;t&&r.randomiser_manager.update_randomiser(t),n&&(r.sim.set_rule(n.to_json()),r.sim_renderer.max_neighbours=n.neighbour.max)})),this.size.notify(),this.entry_browser.select("Default",0),this.shader_manager.update_params({colouring:0}),this.randomise()}return Object(c.a)(e,[{key:"randomise",value:function(){var e=this.randomiser_manager.current_randomiser;this.sim.set_randomiser(e.to_json()),this.sim.randomise()}},{key:"set_size",value:function(e){var t=Object(_.a)(this.size.value,3),n=t[0],r=t[1],a=t[2],i=Object(_.a)(e,3),o=i[0],s=i[1],c=i[2];n===o&&r===s&&a===c||(this.size.value=e)}},{key:"run",value:function(){requestAnimationFrame(this.loop.bind(this))}},{key:"loop",value:function(){this.on_update(),this.on_render(),requestAnimationFrame(this.loop.bind(this))}},{key:"resize",value:function(){var e=this.gl,t=e.canvas,n=t.clientWidth,r=t.clientHeight;n===t.width&&r===t.height||(t.width=n,t.height=r,e.viewport(0,0,n,r),this.camera.aspect_ratio=n/r)}},{key:"on_update",value:function(){this.camera.update()}},{key:"on_render",value:function(){var e=this.gl;this.resize();var t=this.background_colour.value;e.clearColor(t[0]/255,t[1]/255,t[2]/255,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.show_border.value&&this.border.on_render(),this.show_render.value&&this.sim_renderer.on_render()}}]),e}(),Ue=function(){function e(t){var n=this;Object(s.a)(this,e),this.camera=t,this.listeners={onMouseDown:function(e){return n.on_mouse_down(e)},onMouseUp:function(e){return n.on_mouse_up(e)},onMouseMove:function(e){return n.on_mouse_move(e)},onWheel:function(e){return n.on_wheel(e)}},this.rotating=!1,this.zooming=!1,this.mouse_start_pos=O.b.create()}return Object(c.a)(e,[{key:"on_mouse_down",value:function(e){this.rotating=!0,this.mouse_start_pos[0]=e.clientX,this.mouse_start_pos[1]=e.clientY}},{key:"on_mouse_up",value:function(e){this.rotating=!1}},{key:"on_mouse_move",value:function(e){if(this.rotating&&this.mouse_start_pos){var t=O.b.fromValues(e.clientX,e.clientY),n=O.b.create();O.b.sub(n,this.mouse_start_pos,t),O.b.scale(n,n,.005),this.camera.rotate(n[0],n[1]),this.mouse_start_pos=t}}},{key:"on_wheel",value:function(e){var t=.001*e.deltaY;this.camera.zoom(t)}}]),e}(),Ge=function(){function e(t){var n=this;Object(s.a)(this,e),this.camera=t,this.listeners={onTouchStart:function(e){return n.on_touch_start(e)},onTouchMove:function(e){return n.on_touch_move(e)},onTouchEnd:function(e){return n.on_touch_end(e)}},this.rotating=!1,this.zooming=!1,this.total_touches=0,this.touch_start_pos=O.b.create(),this.touch_zoom_distance=0,this.touch_list=[]}return Object(c.a)(e,[{key:"on_touch_start",value:function(e){var t,n=e.touches;if((t=this.touch_list).push.apply(t,Object(x.a)(n)),this.total_touches+=n.length,1===this.total_touches){this.rotating=!0,this.zooming=!1;var r=this.touch_list[this.touch_list.length-1];this.touch_start_pos=O.b.fromValues(r.clientX,r.clientY)}else if(this.total_touches>=2){this.zooming=!0,this.rotating=!1;var a=this.touch_list.slice(this.touch_list.length-2,this.touch_list.length);this.touch_zoom_distance=this.calculate_touch_distance.apply(this,Object(x.a)(a))}}},{key:"on_touch_end",value:function(e){this.rotating=!1,this.zooming=!1,this.touch_list=[],this.total_touches=0,this.total_touches<2&&(this.zooming=!1),this.total_touches<1&&(this.rotating=!1)}},{key:"on_touch_move",value:function(e){(this.rotating||this.zooming)&&(this.rotating?this.on_touch_rotate(e):this.zooming&&this.on_touch_zoom(e))}},{key:"on_touch_rotate",value:function(e){if(!(e.touches.length<1)){var t=e.touches[0],n=O.b.fromValues(t.clientX,t.clientY),r=O.b.create();O.b.sub(r,this.touch_start_pos,n),O.b.scale(r,r,.005),this.camera.rotate(r[0],r[1]),this.touch_start_pos=n}}},{key:"on_touch_zoom",value:function(e){var t=e.touches,n=this.touch_zoom_distance;if(t.length>=2)n=this.calculate_touch_distance(t[0],t[1]);else{var r=t[0],a=this.touch_list[this.touch_list.length-2],i=this.touch_list[this.touch_list.length-1],o=this.calculate_touch_distance(a,r),s=this.calculate_touch_distance(i,r);o<s?(this.touch_list[this.touch_list.length-2]=r,n=s):(this.touch_list[this.touch_list.length-1]=r,n=o)}var c=n/this.touch_zoom_distance;this.touch_zoom_distance=n,this.camera.zoom(1-c)}},{key:"calculate_touch_distance",value:function(e,t){var n=O.b.fromValues(e.clientX,e.clientY),r=O.b.fromValues(t.clientX,t.clientY),a=O.b.create();return O.b.sub(a,n,r),O.b.length(a)}}]),e}(),Ve=(n(124),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).mouse_controller=new Ue,r.touch_controller=new Ge,r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.canvas.current.getContext("webgl2");if(!e)throw new Error("WebGL not supported");var t=this.create_app(e).camera;this.mouse_controller.camera=t,this.touch_controller.camera=t,this.focus_timeout=this.create_focus_timeout()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.focus_timeout)}},{key:"create_focus_timeout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,n=setTimeout((function(){return e.change_focus(!1)}),t);return n}},{key:"on_mouse_move",value:function(){clearTimeout(this.focus_timeout),this.focus_timeout=this.create_focus_timeout(),this.change_focus(!0)}},{key:"change_focus",value:function(e){var t=this.props.store;t.getState().gui.focused!==e&&t.dispatch(function(e){return{type:"gui.focused",value:e}}(e))}},{key:"create_app",value:function(e){var t=this.props.store,n=t.getState().app;if(n)return n;var r=function(e){var t,n,r,a,i;return Object(h.c)({app:(i=e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"step":e.sim.step();break;case"stop":e.sim.stop();break;case"start":e.sim.start();break;case"toggle":e.sim.toggle();break;case"clear":e.sim.clear();break;case"randomise":e.randomise();break;case"app.set_size":e.set_size(t.value);break;case"app.show_border":e.show_border.value=t.value;break;case"app.show_render":e.show_render.value=t.value;break;case"app.set_background_colour":e.background_colour.value=t.value;break;case"app.set_border_colour":e.border.colour.value=t.value}return e}),entry_browser:(a=e.entry_browser,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"entry.refresh":return e;case"entry.select":var n=t.value,r=n.key,i=n.index;e.select(r,i)}return e}),shader_manager:(r=e.shader_manager,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"shader.select_renderer":e.select_renderer(t.value);break;case"shader.update_params":e.update_params(t.value)}return e}),stats:(n=e.stats,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"stats.update":return t.value}return e}),randomiser:(t=e.randomiser_manager,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"randomiser.select":e.select(n.value);break;case"randomiser.update":e.update_current(n.name,n.value)}return e}),gui:d()})}(n=new Ie(e,t));return t.replaceReducer(r),n.run(),n}},{key:"render",value:function(){for(var e=this,t=function(t){return e.on_mouse_move()},n={},r=0,i=["onMouseMove","onMouseDown","onMouseUp","onTouchMove","onTouchStart","onTouchEnd"];r<i.length;r++){n[i[r]]=t}return a.a.createElement("div",Object.assign({className:"w-100 h-100 pb-2"},n),a.a.createElement("canvas",Object.assign({className:"w-100 h-100",ref:this.props.canvas},this.mouse_controller.listeners,this.touch_controller.listeners)))}}]),n}(a.a.Component));function Be(){var e=Object(m.b)(),t=Object(m.c)((function(e){return e.gui.fullscreen})),n=t?"compress-arrows-alt":"arrows-alt";return a.a.createElement("button",{className:"btn btn-secondary",onClick:function(){!function(t){var n=document.documentElement,r=document,a=n.requestFullscreen||n.mozRequestFullScreen||n.webkitRequestFullScreen||n.msRequestFullscreen,i=r.exitFullscreen||r.mozCancelFullScreen||r.webkitCancelFullScreen||r.msExitFullscreen;r.fullscreenElement&&void 0!==r.fullscreenElement||r.mozFullscreen||r.webkitIsFullScreen?(i.bind(r)(),e(w(!1))):(a.bind(n)(),e(w(!0)))}()}},a.a.createElement("i",{className:"fas fa-".concat(n," fa-sm")}))}n(125);function Xe(e){var t=Object(m.d)(),n=Object(m.c)((function(e){return e.app})),r=Object(m.c)((function(e){return e.gui.fullscreen})),i=Object(m.c)((function(e){return e.gui.focused})),o=Object(m.c)((function(e){return e.app&&e.app.background_colour.value})),s=r&&!i?"fade":"";var c=o||[255,255,255],u=Object(_.a)(c,3),l=u[0],h=u[1],f=u[2],d="rgb(".concat(l,",").concat(h,",").concat(f,")");return a.a.createElement("div",{className:"card sim-view shadow h-100",style:{border:"1px solid ".concat(d)}},a.a.createElement(Ve,{store:t,canvas:e.canvas}),n?a.a.createElement("div",{className:s,style:{zIndex:1,position:"absolute",bottom:"1.5rem",alignSelf:"center"}},a.a.createElement("div",null,a.a.createElement(E,null))):a.a.createElement("div",null),a.a.createElement("div",{className:s,style:{zIndex:2,position:"absolute",top:"1.5rem",right:"1.5rem"}},a.a.createElement(Be,null)),a.a.createElement("div",{className:s,style:{zIndex:3,position:"absolute",top:"1.5rem",left:"1.5rem"}},a.a.createElement("a",{className:"btn btn-dark btn-circle btn-md",href:"https://github.com/FiendChain/3D-Cellular-Automata",target:"_blank",rel:"noopener noreferrer","data-toggle":"tooltip","data-placement":"left",title:"Github Repository"},a.a.createElement("i",{className:"fab fa-github"}))))}n(48);function qe(e){var t=Object(r.useState)(e.name||""),n=Object(_.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)(e.ca_string||""),c=Object(_.a)(s,2),u=c[0],l=c[1],h=Object(r.useState)(!1),f=Object(_.a)(h,2),d=f[0],m=f[1],v=e.onSubmit,p=e.onExit,b=e.errors;function g(e){e&&e.preventDefault(),v&&v(i,u)}var y=b?"is-invalid":"",w=a.a.createElement("form",{onSubmit:g,onKeyDown:function(e){13===e.keyCode&&g(e)},className:"w-75"},a.a.createElement("div",{className:"form-group row mb-0 mt-0"},a.a.createElement("label",{className:"col-sm-3 col-form-label py-0"},"Name:"),a.a.createElement("div",{className:"col-sm py-0"},a.a.createElement("input",{type:"text",className:"form-control form-control-sm w-100 py-0",value:i,onChange:function(e){return o(e.target.value)}}))),a.a.createElement("div",{className:"form-group row mt-0 mb-0"},a.a.createElement("div",{className:"col-sm-3 col-form-label py-0"},a.a.createElement("label",{className:"mr-1"},"Rule:"),a.a.createElement("span",{className:"","data-toggle":"tooltip","data-placement":"left","data-html":!0,title:"[Remain Alive]/[Become Alive]/[Total States]/[Neighbourhood]\n[Remain Alive]: Range where a cell stays alive. E.g. 0-3,9\n[Become Alive]: Range where a cell goes from dead to alive. E.g. 0-3,9\n[Total States]: Number of states a cell goes through when dying. E.g. 10\n[Neighbourhood]: Type of neighbour counting. 'M' counts all 26, and 'VN' counts 6"},a.a.createElement("i",{className:"fas fa-question-circle"}))),a.a.createElement("div",{className:"col-sm py-0"},a.a.createElement("input",{type:"text",className:"form-control form-control-sm w-100 py-0 ".concat(y),id:"ca_string",value:u,onChange:function(e){return l(e.target.value)}}),b&&function(e){var t=String(e).split("\n");return a.a.createElement("div",{className:"invalid-feedback"},t.map((function(e,t){return a.a.createElement("div",{key:t},e)})))}(b)))),E=a.a.createElement("div",{className:"actions ".concat(!d&&"fade"),onMouseOver:function(){return m(!0)}},a.a.createElement("button",{className:"btn btn-circle btn-sm btn-warning",onClick:function(){p&&p()}},a.a.createElement("i",{className:"fas fa-ban"})),a.a.createElement("button",{className:"btn btn-circle btn-sm btn-success",onClick:g},a.a.createElement("i",{className:"fas fa-check-circle"})));return a.a.createElement("div",{onMouseEnter:function(){return m(!0)},onMouseLeave:function(){return m(!1)}},w,E)}function Ye(e){var t=Object(m.b)(),n=Object(r.useState)(!1),i=Object(_.a)(n,2),o=i[0],s=i[1],c=Object(r.useState)(!1),u=Object(_.a)(c,2),l=u[0],h=u[1],f=e.browser,d=e.index,v=e.name,p=e.ca_string,b=e.selected,g=e.actions,y=g.del,w=g.copy,E=g.edit,x=e.onEdit,O=function(e){t(function(e,t){return function(n,r){r().entry_browser.delete(e,t).then((function(){n({type:"entry.refresh"})}))}}(f,d)),e.preventDefault()},j=function(e){navigator.permissions.query({name:"clipboard-write"}).then((function(e){"granted"!==e.state&&"prompt"!==e.state||navigator.clipboard.writeText(p).then((function(){return h(!0)}))})),e.preventDefault()},k=function(e){e.preventDefault(),x&&x()},S=function(){return a.a.createElement("div",{className:"d-inline"},a.a.createElement("button",{className:"btn btn-circle btn-sm btn-light",onClick:j,onMouseLeave:function(){return h(!1)}},a.a.createElement("span",{className:"icon text-gray-600"},a.a.createElement("i",{className:"fas fa-copy"}))),a.a.createElement("div",{className:"tooltip copy-text ".concat(l?"show":"fade"),role:"tooltip"},a.a.createElement("div",{className:"tooltip-inner"},"Copied ",v,"!")))};return a.a.createElement("li",{className:"list-group-item ".concat(b?"active":"")},a.a.createElement("div",{onMouseEnter:function(){return s(!0)},onMouseLeave:function(){return s(!1)}},a.a.createElement("div",{onClick:function(e){t(function(e,t){return{type:"entry.select",value:{key:e,index:t}}}(f,d)),e.preventDefault()}},a.a.createElement("div",null,"Name: ",v),a.a.createElement("div",null,"Rule: ",p)),a.a.createElement("div",{className:"actions ".concat(!o&&"fade"),onMouseOver:function(){return s(!0)}},w&&S(),y&&a.a.createElement("button",{className:"btn btn-circle btn-sm btn-danger",onClick:O},a.a.createElement("i",{className:"fas fa-trash"})),E&&a.a.createElement("button",{className:"btn btn-circle btn-sm btn-primary",onClick:k},a.a.createElement("i",{className:"fas fa-edit"})))))}function We(e){var t=Object(m.b)(),n=e.entry,i=e.browser,o=e.index,s=Object(r.useState)(!1),c=Object(_.a)(s,2),u=c[0],l=c[1],h=Object(r.useState)(void 0),f=Object(_.a)(h,2),d=f[0],v=f[1],p=Object(r.useState)(n.name),b=Object(_.a)(p,2),g=b[0],y=b[1],w=Object(r.useState)(n.description),E=Object(_.a)(w,2),x=E[0],O=E[1],j=function(e,n){t(function(e,t,n,r,a){return function(i,o){o().entry_browser.edit(e,t,n,r).then((function(){a(!1),i({type:"entry.refresh"})}),(function(e){a(e)}))}}(i,o,e,n,(function(t){v(t),l(!!t),t||(y(e),O(n))})))},k=function(){l(!1),v(!1)};return u?a.a.createElement("li",{className:"list-group-item"},a.a.createElement(qe,{name:g,ca_string:x,onSubmit:j,onExit:k,errors:d})):a.a.createElement(Ye,{browser:i,index:o,name:g,ca_string:x,actions:e.actions,selected:e.selected,onEdit:function(){return l(!0)}})}function He(){var e=Object(m.b)(),t=Object(r.useState)(!1),n=Object(_.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)(!1),c=Object(_.a)(s,2),u=c[0],l=c[1],h=function(t,n){e(function(e,t,n){return function(r,a){a().entry_browser.create(e,t).then((function(){n(!1),r({type:"entry.refresh"})}),(function(e){n(e)}))}}(t,n,(function(e){l(e),o(!!e)})))},f=function(){o(!1),l(!1)};return i?a.a.createElement("li",{className:"list-group-item"},a.a.createElement(qe,{errors:u,onSubmit:h,onExit:f})):a.a.createElement("li",{className:"list-group-item",style:{textAlign:"center"}},a.a.createElement("button",{className:"btn btn-circle btn-md btn-secondary shadow",onClick:function(){return o(!0)}},a.a.createElement("span",{className:"icon text-white-600 m-0"},a.a.createElement("i",{className:"fas fa-plus"}))))}function Ke(){var e=Object(m.c)((function(e){return e.entry_browser.current_browser_key})),t=Object(m.c)((function(e){return e.entry_browser.selected_browser.current_index})),n=Object(r.useState)(e),i=Object(_.a)(n,2),o=i[0],s=i[1],c=Object(m.c)((function(e){return e.entry_browser.browsers})),u=Object(m.c)((function(e){return e.entry_browser.get_entries(o)})),l="User"===o,h=[];for(var f in c)h.push(f);var d=a.a.createElement("div",{className:"d-flex flex-row my-0 py-0"},a.a.createElement("div",{className:"btn-group py-0 my-0"},h.map((function(e,t){var n=e===o;return a.a.createElement("button",{className:"btn btn-sm ".concat(n?"btn-primary":"btn-outline-secondary"),key:t,onClick:function(){return s(e)}},e)}))));return a.a.createElement("div",{className:"card shadow mb-2"},a.a.createElement("div",{className:"card-header py-2 d-flex flex-row align-items-center justify-content-between"},a.a.createElement("h6",{className:"m-0 font-weight-bold text-primary"},"Rules"),d),a.a.createElement("div",{className:"collapse show",id:"collapseRulesBrowser"},a.a.createElement("ul",{className:"list-group"},u.map((function(n,r){var i={entry:n,browser:o,index:r,actions:{del:l,copy:!0,edit:l},selected:r===t&&o===e},s=void 0===n.id?r:n.id;return a.a.createElement(We,Object.assign({},i,{key:"".concat(o,"_").concat(s)}))}))),l&&a.a.createElement(He,null)))}n(126);function Je(e){return a.a.createElement("span",{className:"help-icon","data-toggle":"tooltip","data-placement":"left","data-html":!0,title:e.text},a.a.createElement("i",{className:"fas fa-question-circle"}))}n(127);var $e=n(110);function Qe(e){var t=e.color,n=e.valueChanged,i=Object(r.useState)(!1),o=Object(_.a)(i,2),s=o[0],c=o[1],u={r:t[0],g:t[1],b:t[2],a:1};return a.a.createElement("div",null,a.a.createElement("div",{className:"swatch",onClick:function(){return c(!s)}},a.a.createElement("div",{className:"color-display",style:{background:"rgba(".concat(u.r,", ").concat(u.g,", ").concat(u.b,", ").concat(u.a,")")}})),s&&a.a.createElement("div",{className:"popover"},a.a.createElement("div",{className:"cover",onClick:function(){return c(!1)}}),a.a.createElement($e.ChromePicker,{color:u,onChange:function(e){var t=e.rgb;n([t.r,t.g,t.b])},disableAlpha:!0})))}function Ze(e,t,n,r){switch(e.type){case"slider":return function(e,t,n,r){var i=(e.max-e.min)/100;return a.a.createElement("div",{className:"row w-100",key:t},a.a.createElement("div",{className:"col-sm-5"},n,": ",e.value.toFixed(2)),a.a.createElement("div",{className:"col-sm d-flex"},a.a.createElement("input",{className:"form-control-range my-auto",type:"range",min:e.min,max:e.max,value:e.value,step:i,onChange:function(e){return r(Number(e.target.value))}})),e.help&&a.a.createElement("div",{className:"col-sm-1 text-right"},a.a.createElement(Je,{text:e.help})))}(e,t,n,r);case"toggle":return function(e,t,n,r){return a.a.createElement("div",{className:"row w-100",key:t},a.a.createElement("div",{className:"col-sm-5"},a.a.createElement("label",{className:"form-check-label"},n)),a.a.createElement("div",{className:"col-sm"},a.a.createElement("input",{type:"checkbox",className:"form-check-input ml-0",checked:e.value,onChange:function(e){return r(e.target.checked)}})),e.help&&a.a.createElement("div",{className:"col-sm-1 text-right"},a.a.createElement(Je,{text:e.help})))}(e,t,n,r);case"dropdown":return function(e,t,n,r){return a.a.createElement("div",{className:"row w-100",key:t},a.a.createElement("div",{className:"col-sm-5"},a.a.createElement("label",null,n," ")),a.a.createElement("div",{className:"col-sm"},a.a.createElement("select",{className:"custom-select custom-select-sm",value:e.value,onChange:function(e){return r(Number(e.target.value))}},e.options.map((function(e,r){return a.a.createElement("option",{value:r,key:"".concat(n,"_").concat(t,"_").concat(r)},e)})))),e.help&&a.a.createElement("div",{className:"col-sm-1 text-right"},a.a.createElement(Je,{text:e.help})))}(e,t,n,r);case"color":return function(e,t,n,r){return a.a.createElement("div",{className:"row w-100",key:t},a.a.createElement("div",{className:"col-sm-5"},a.a.createElement("label",null,n)),a.a.createElement("div",{className:"col-sm"},a.a.createElement(Qe,{color:e.value,valueChanged:r})),e.help&&a.a.createElement("div",{className:"col-sm-1 text-right"},a.a.createElement(Je,{text:e.help})))}(e,t,n,r);default:return}}function et(){var e=Object(m.b)(),t=Object(m.c)((function(e){return e.app.show_border})),n=Object(m.c)((function(e){return e.app.show_render})),r=Object(m.c)((function(e){return e.app.background_colour})),i=Object(m.c)((function(e){return e.app.border.colour}));Object(m.c)((function(e){return e.app.show_border.value}));return Object(m.c)((function(e){return e.app.show_render.value})),Object(m.c)((function(e){return e.app.background_colour.value})),Object(m.c)((function(e){return e.app.border.colour.value})),a.a.createElement("div",null,Ze(t,0,"Show Border",(function(t){e({type:"app.show_border",value:t})})),Ze(i,1,"Border Colour",(function(t){e({type:"app.set_border_colour",value:t})})),Ze(n,2,"Show Render",(function(t){e({type:"app.show_render",value:t})})),Ze(r,3,"Background Colour",(function(t){e({type:"app.set_background_colour",value:t})})))}function tt(){var e=Object(m.b)(),t=Object(m.c)((function(e){return e.shader_manager.renderer_type})),n=(Object(m.c)((function(e){return e.shader_manager.renderer_type.value})),a.a.createElement("div",null,a.a.createElement("div",null,Ze(t,0,"Renderer",(function(t){e({type:"shader.select_renderer",value:t})}))),a.a.createElement(et,null),a.a.createElement("hr",null),a.a.createElement(nt,null)));return a.a.createElement("div",{className:"card shadow mb-2"},a.a.createElement("a",{href:"#collapseGraphicsMenu",className:"card-header d-block","data-toggle":"collapse",role:"button","aria-expanded":"true","aria-controls":"collapseGraphicsMenu"},a.a.createElement("h6",{className:"m-0 font-weight-bold text-primary"},"Graphics")),a.a.createElement("div",{className:"collapse show",id:"collapseGraphicsMenu"},a.a.createElement("div",{className:"card-body"},n)))}function nt(){var e=Object(m.b)(),t=Object(m.c)((function(e){return e.shader_manager.params})),n=Object(m.c)((function(e){return e.shader_manager.renderer_type.value}));return a.a.createElement("div",null,Object.entries(t).map((function(t,r){var a=Object(_.a)(t,2),i=a[0];return Ze(a[1],"".concat(n,"_").concat(r),i,(function(t){var n={};n[i]=t,e(function(e){return{type:"shader.update_params",value:e}}(n))}))})))}function rt(){var e=Object(m.b)(),t=Object(m.c)((function(e){return e.app.size.value})),n=Object(r.useState)(t[0]),i=Object(_.a)(n,2),o=i[0],s=i[1],c=Object(r.useState)(t[1]),u=Object(_.a)(c,2),l=u[0],h=u[1],f=Object(r.useState)(t[2]),d=Object(_.a)(f,2),v=d[0],p=d[1];function b(e){var t=Number(e);return t=Math.max(t,1),t=Math.min(t,1e3)}var g=a.a.createElement("form",{onSubmit:function(t){return function(t){var n=b(o),r=b(l),a=b(v);s(n),h(r),p(a);var i=O.c.fromValues(n,r,a);e(function(e){return{type:"app.set_size",value:e}}(i)),t.preventDefault()}(t)}},a.a.createElement("div",{className:"input-group mb-0"},a.a.createElement("input",{type:"number",value:o,max:1e3,min:1,onChange:function(e){return s(e.target.value)}}),a.a.createElement("input",{type:"number",value:l,max:1e3,min:1,onChange:function(e){return h(e.target.value)}}),a.a.createElement("input",{type:"number",value:v,max:1e3,min:1,onChange:function(e){return p(e.target.value)}}),a.a.createElement("div",{className:"input-group-append"},a.a.createElement("button",{type:"submit",className:"btn btn-primary btn-sm"},"Apply"))));return a.a.createElement("div",{className:"card shadow mb-2"},a.a.createElement("a",{href:"#collapseSizeChanger",className:"card-header d-block","data-toggle":"collapse","aria-expanded":"true","aria-controls":"collapseSizeChanger"},a.a.createElement("h6",{className:"m-0 font-weight-bold text-primary"},"Size Controls")),a.a.createElement("div",{className:"collapse show",id:"collapseSizeChanger"},a.a.createElement("div",{className:"card-body"},g)))}function at(){var e=Object(m.c)((function(e){return e.stats.data.completed_blocks})),t=Object(m.c)((function(e){return e.stats.data.total_blocks})),n=Object(m.c)((function(e){return e.stats.data.frame_time})),r=Object(m.c)((function(e){return e.stats.data.total_steps})),i=Object(m.c)((function(e){return e.stats.data.texture_data_update})),o=Object(m.c)((function(e){return e.stats.data.texture_data_upload})),s=Object(m.c)((function(e){return e.stats.data.draw_time})),c=0;t>0&&(c=e/t*100);var u=a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col"},a.a.createElement("div",null,"Total Steps: ",r),a.a.createElement("div",null,"Frame Time (ms): ",n.toFixed(2)),a.a.createElement("div",null,"Draw Time (ms): ",s.toFixed(2))),a.a.createElement("div",{className:"col"},a.a.createElement("div",null,"Tex Update (ms): ",i.toFixed(2)),a.a.createElement("div",null,"Tex Upload (ms): ",o.toFixed(2)))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col"},"Progress: ",e,"/",t," (",c.toFixed(2),"%)")));return a.a.createElement("div",{className:"card shadow"},a.a.createElement("a",{href:"#collapseStatsMenu",className:"card-header d-block","data-toggle":"collapse",role:"button","aria-expanded":"true","aria-controls":"collapseStatsMenu"},a.a.createElement("h6",{className:"m-0 font-weight-bold text-primary"},"Statistics")),a.a.createElement("div",{className:"collapse show",id:"collapseStatsMenu"},a.a.createElement("div",{className:"card-body"},u)))}function it(){var e=Object(m.b)(),t=Object(m.c)((function(e){return e.randomiser.current_index}));var n=Object(m.c)((function(e){return e.randomiser.entries})).map((function(e,t){return a.a.createElement("option",{value:t,key:t},e.type)})),r=a.a.createElement("div",null,a.a.createElement("div",{className:"row w-100"},a.a.createElement("div",{className:"col-sm-5"},a.a.createElement("label",{className:"mr-2"},"Randomiser")),a.a.createElement("div",{className:"col-sm"},a.a.createElement("select",{className:"custom-select custom-select-sm",value:t,onChange:function(t){var n=t.target.value;e(function(e){return{type:"randomiser.select",value:e}}(n))}},n)),a.a.createElement("div",{className:"col-sm-1 text-right"},a.a.createElement(Je,{text:"Type of randomiser to use"}))),a.a.createElement("hr",null),a.a.createElement(ot,null));return a.a.createElement("div",{className:"card shadow mb-2"},a.a.createElement("a",{href:"#collapseRandomiserMenu",className:"card-header d-block","data-toggle":"collapse",role:"button","aria-expanded":"true","aria-controls":"collapseRandomiserMenu"},a.a.createElement("h6",{className:"m-0 font-weight-bold text-primary"},"Randomiser")),a.a.createElement("div",{className:"collapse show",id:"collapseRandomiserMenu"},a.a.createElement("div",{className:"card-body"},r)))}function ot(){var e=Object(m.b)(),t=Object(m.c)((function(e){return e.randomiser.current_randomiser.params}));var n=Object.entries(t).map((function(t,n){var r=Object(_.a)(t,2),a=r[0];return Ze(r[1],n,a,(function(t){!function(t,n){e(function(e,t){return{type:"randomiser.update",name:e,value:t}}(t,n))}(a,t)}))}));return a.a.createElement("form",null,n)}var st=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).store=Object(h.e)(Object(h.c)({gui:d()}),Object(h.d)(Object(h.a)(v.a))),r.canvas=a.a.createRef(),r}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement(m.a,{store:this.store},a.a.createElement(ct,{canvas:this.canvas}))}}]),n}(a.a.Component);function ct(e){var t=Object(m.c)((function(e){return e.app})),n=Object(m.c)((function(e){return e.gui.fullscreen}));var r=a.a.createElement(Xe,{canvas:e.canvas});return a.a.createElement("div",{className:"vh-100 vw-100"},a.a.createElement("div",{className:"row px-0 mx-0"},t&&a.a.createElement("div",{className:"col-sm-3 overflow-auto vh-100 ".concat(n&&"d-none")},a.a.createElement(rt,null),a.a.createElement(tt,null),a.a.createElement(it,null),a.a.createElement(at,null)),a.a.createElement("div",{className:"col vh-100 mx-0 px-0"},r),t&&a.a.createElement("div",{className:"col-sm-3 overflow-auto vh-100 ".concat(n&&"d-none")},a.a.createElement(Ke,null))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(295);o.a.render(a.a.createElement(st,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},48:function(e,t,n){}},[[117,1,2]]]);
//# sourceMappingURL=main.418a9dd4.chunk.js.map